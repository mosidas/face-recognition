# RealTimeFaceRecognizer

リアルタイムで顔認識を行うアプリケーションです。カメラ映像から顔を検出し、あらかじめ用意された参照画像の顔と比較してコサイン類似度を計算・表示します。

## 機能

- カメラからのリアルタイム映像を処理
- YOLOv11ベースの顔検出
- 顔の埋め込みベクトル抽出と比較
- コサイン類似度の計算と表示
- 類似度に応じた色分け表示（緑: 高、黄: 中、赤: 低）
- **処理速度最適化**: 画像を1/2にダウンスケールして顔検出を高速化

## 使用方法

```bash
RealTimeFaceRecognizer <検出モデルパス> <認識モデルパス> <顔画像フォルダパス> [カメラID]
```

### パラメータ

- `検出モデルパス`: 顔検出用のONNXモデルファイルのパス
- `認識モデルパス`: 顔認識（埋め込み抽出）用のONNXモデルファイルのパス
- `顔画像フォルダパス`: 参照顔画像が格納されているフォルダのパス
- `カメラID` (オプション): 使用するカメラのデバイスID（デフォルト: 0）

### 実行例

```bash
# 基本的な使用方法
RealTimeFaceRecognizer models/yolov11-face.onnx models/arcface.onnx ./reference_faces/

# カメラIDを指定する場合
RealTimeFaceRecognizer models/yolov11-face.onnx models/arcface.onnx ./reference_faces/ 1
```

## 参照画像について

- 参照画像フォルダには、比較対象となる人物の顔が写った画像を配置します
- 対応フォーマット: JPEG, PNG, BMP
- フォルダ内のすべての画像から検出された顔は同一人物として扱われます
- 複数の角度や表情の画像を用意することで認識精度が向上します

## 操作方法

- `q`、`Q`、または`ESC`キー: アプリケーションを終了

## 表示情報

- 緑色の枠: 高い類似度（0.6以上）
- 黄色の枠: 中程度の類似度（0.4〜0.6）
- 赤色の枠: 低い類似度（0.4未満）
- Sim: コサイン類似度の値（0.0〜1.0）

## 必要な環境

- .NET 8.0
- OpenCV
- ONNX Runtime
- 対応するONNXモデルファイル

## パフォーマンス最適化

### 画像ダウンスケール機能
- 処理速度向上のため、顔検出前に画像を1/2（0.5倍）にダウンスケールします
- 検出結果の座標は元の解像度に自動的にアップスケールされます
- 埋め込みベクトル抽出は元の解像度で行われるため、認識精度は維持されます
- この最適化により処理時間を約50-70%短縮できます

### 期待される処理時間改善
- 顔検出: 大幅な高速化（画像サイズに比例）
- 埋め込み抽出: 品質維持のため元解像度で実行
- 全体的な処理速度: 大幅向上

## トラブルシューティング

### カメラが開けない場合
- カメラが正しく接続されているか確認してください
- 他のアプリケーションがカメラを使用していないか確認してください
- カメラIDを変更してみてください（0, 1, 2...）

### 顔が検出されない場合
- 十分な明るさがあることを確認してください
- カメラと顔の距離を調整してください
- 検出しきい値の調整を検討してください
- ダウンスケールにより小さい顔の検出精度が下がる場合があります 
