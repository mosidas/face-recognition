# ExampleCLI - ONNX推論サンプルアプリケーション

RecoginizerライブラリをOnce使用した物体検出と顔認証のCLIサンプルアプリケーションです。

## 概要

このプロジェクトは、Recognizerライブラリの使用例を示すコンソールアプリケーションです。
インタラクティブなCLIを通じて以下の機能を試すことができます：

- **物体検出**（YOLOモデル）
- **顔認証**（顔照合・顔識別）

## 前提条件

- .NET 8.0 SDK
- ONNXモデルファイル
  - 物体検出用: YOLOv5/v8のONNXモデル
  - 顔認証用: 顔検出モデルと顔認識モデル

## ビルドと実行

```bash
# プロジェクトディレクトリに移動
cd src/ExampleCLI

# ビルド
dotnet build

# 実行
dotnet run
```

## 使い方

### 1. 物体検出

プログラムを実行し、「1」を選択すると物体検出モードになります。

```
ONNX推論サンプル
================
1. 物体検出 (YOLO)
2. 顔認証
選択してください (1 or 2): 1

=== 物体検出デモ ===
YOLOモデルファイルのパス (.onnx): models/yolov5s.onnx
検出する画像のパス: images/sample.jpg
```

検出結果が表示され、オプションで結果画像を保存できます。

### 2. 顔認証

「2」を選択すると顔認証モードになります。

#### 顔照合（1:1）
2つの画像の顔を比較して同一人物かどうかを判定します。

```
=== 顔認証デモ ===
顔検出モデルのパス (.onnx): models/face_detector.onnx
顔認識モデルのパス (.onnx): models/face_recognizer.onnx

1. 顔照合（2つの画像を比較）
2. 顔識別（データベースから検索）
選択してください (1 or 2): 1

1つ目の画像パス: images/person1.jpg
2つ目の画像パス: images/person2.jpg
```

#### 顔識別（1:N）
データベースに登録した顔から一致する人物を検索します。

```
選択してください (1 or 2): 2

顔データベースに人物を登録します
登録する人数: 3

人物 1:
名前: 田中太郎
画像パス: images/tanaka.jpg

人物 2:
名前: 佐藤花子
画像パス: images/sato.jpg

人物 3:
名前: 鈴木一郎
画像パス: images/suzuki.jpg

識別する画像のパス: images/query.jpg
```

## プロジェクト構造

```
ExampleCLI/
├── ExampleCLI.csproj    # プロジェクトファイル
├── Program.cs           # メインプログラム
└── README.md           # このファイル
```

## カスタマイズ

### 信頼度の閾値調整

`Program.cs`内の以下の値を調整できます：

```csharp
// 物体検出
confidenceThreshold: 0.5f,  // 検出の信頼度閾値
nmsThreshold: 0.5f          // NMSの閾値

// 顔認証
detectionThreshold: 0.7f,   // 顔検出の閾値
recognitionThreshold: 0.6f  // 顔認識の閾値
```

### クラス名のカスタマイズ

COCO以外のデータセットを使用する場合は、`CocoClassNames.Names`を独自のクラス名配列に置き換えてください。

## トラブルシューティング

### "ファイルが見つかりません"エラー
- モデルファイルと画像ファイルのパスが正しいか確認してください
- 相対パスまたは絶対パスを使用できます

### "CUDA is not available"メッセージ
- GPUが利用できない環境ではCPUモードで動作します
- パフォーマンスは低下しますが、機能に問題はありません

### メモリ不足エラー
- 大きな画像を処理する際はメモリ使用量に注意してください
- 必要に応じて画像をリサイズしてから処理してください

## ライセンス

このサンプルプログラムはMITライセンスで公開されています。 
